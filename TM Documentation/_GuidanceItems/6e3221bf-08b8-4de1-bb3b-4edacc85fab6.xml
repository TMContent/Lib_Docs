<?xml version="1.0"?>
<TeamMentor_Article Metadata_Hash="0" Content_Hash="0">
  <Metadata>
    <Id>6e3221bf-08b8-4de1-bb3b-4edacc85fab6</Id>
    <Library_Id>eb39d862-f752-4d1c-ab6e-14ed697397c0</Library_Id>
    <Title>Active Directory Support</Title>
    <Category />
    <Phase />
    <Technology />
    <Type />
    <DirectLink>Active Directory Support</DirectLink>
  </Metadata>
  <Content Sanitized="false" DataType="wikitext">
    <Data><![CDATA[By default TEAM Mentor uses its Xml-based User Store, but it is possible to use Active Directory to authenticate users.

===Set-up==

These are the steps required to set it up

**Step 1: Configure web.config file **

In this file (which you will find in the Web Root '\Web Applications\TM_Website') you need to make one change: Set the impersonate value of the system.web identity element

By default the impersonate value is set to false, so you will need to set it to true
{{{
	<system.web>
		...
		<identity impersonate="false"/> <!-- for TEAM Mentor ActiveDirectory support set to true-->
                <authentication mode="None"/>   <!-- for TEAM Mentor ActiveDirectory support set to Windows-->
                ...
	</system.web>
}}}

Due to changes in .Net 4 and IIS, the following setting must also be set when impersonate="true" (note that the default value is already set to false)
{{{
	<system.webServer>
	    <validation  validateIntegratedModeConfiguration="false"/> <!-- for TEAM Mentor ActiveDirectory support-->
            <modules runAllManagedModulesForAllRequests="true" />      <!-- for TeamMentor ActiveDirectory support-->
		...	
	</system.webServer>
}}}

**Step 2: Configure TMConfig.Config file **

In this file (which you will find in the Web Root '\Web Applications\TM_Website') you need to make two changes: Enable Windows Authentication and set the relevant security groups.

By default WindowsAuthentication is set to false, so you will need to set the Enabled element to true and change the ReaderGroup, EditorGroup, AdminGroup values to match your Active Directory settings
{{{
	<TMConfig>
		<WindowsAuthentication>
			<Enabled>true</Enabled>
			<ReaderGroup>TEAMMENTOR\TEAM Mentor Readers</ReaderGroup>
			<EditorGroup>TEAMMENTOR\TEAM Mentor Editors</EditorGroup>
			<AdminGroup>TEAMMENTOR\TEAM Mentor Admins</AdminGroup>
		</WindowsAuthentication>
	</TMConfig>
}}}

**Step 3: Disabling IIS Anonymous access  and Enabling Windows Authentication **

Make sure you have already installed Windows Authentication in the server where you are configuring TEAM Mentor to use Active Directory.   Windows Authentication can be installed from the Add Roles and Features from the Server Manager Dashboard. You can read more about how to install Windows Authentication here [[http://www.iis.net/configreference/system.webserver/security/authentication/windowsauthentication]]

Once Windows Authentication has been installed, then it's necessary to enable it for the current Web site and then disable Anonymous access. 
In order to to that, you need to select the TEAM Mentor Web site and then select the Authentication feature from the IIS group. Make sure Anonymous access is disabled and Windows Authentication is enabled for this Web site.

**Step 4: Security settings **

Now that you have created the Web site, you need to assign security permissions. First you need grant the application pool identity with permissions on the Web Site. When discovering the user, you will need to use the format **IIS AppPool\[Name of the Application Pool]**.You need to find this user at the server level and not at the domain level.

Then you need to grant the Active Directory groups with permissions in the TEAM Mentor Web application. If there is an Active Directory group called TeamMentorReader for instance, which should be used just for readers, then you need to grant this group with permissions in the TEAM Mentor site. You need to select the Web site, right click on it, and select the Edit Permissions option from the contextual menu, from there you need to enter the group name.


== Troubleshoot ==


**Q: You get a 401 error when connecting to the IIS server from a remote computer, but it works locally**

**A: ** See this Microsoft KB for a workaround [[http://support.microsoft.com/kb/871179]]

**Q: You get this error when running TEAM Mentor on a fresh IIS installation: //"Handler'"WebServiceHandlerFactory-Integrated' has a bad module 'ManagedPipelineHandler' in its module list."//**

**A: ** Try running //aspnet_regiis.exe -i// from the .Net 4.0 folder. See this post for more details: http://forums.iis.net/p/1149449/1869918.aspx


==References==
* on why need to set validateIntegratedModeConfiguration=false
** [[http://forums.iis.net/t/1187993.aspx]]
* Installing Windows Authentication
** [[http://www.iis.net/configreference/system.webserver/security/authentication/windowsauthentication/providers/add]]]]></Data>
  </Content>
</TeamMentor_Article>